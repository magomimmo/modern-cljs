# Tutorial 1 - The Basics

In this first tutorial we are going to create and configure a minimum
ClojureScript ([CLJS][1]) project by using the [boot][2] build tool.

## Requirements

This tutorial requires `java` and `boot` to be installed on your
computer.

To install `java` follow the [instructions][3] for your operating
system. To install `boot` follow the very easy instructions in the
corresponding section of its [README][4].

Test the installation by issuing the `boot -h` command at the
terminal. Then submit the `boot -u` command to get the latest `boot`
updates.

> NOTE 1: I strongly suggest to use Java 8. If you're using Java 7, it
> might be worth mentioning
> https://github.com/boot-clj/boot/wiki/JVM-Options#permgen-errors

## Create the project structure

A minimum CLJS web project is composed of 3 files:

* an html page;
* a CLJS source code;
* a `boot` build file to compile CLJS source code.

Even if CLJS does not dictate a specific directory structure, it's a
good practice to organize your project in such a way that it will be
easy for anyone, even yourself in a few months, to be able to
understand the project components and its structure. Moreover, each
building tool has its own idiosyncrasies, which they call
defaults. The more you adhere to the defaults of the tool at
hand, the less pain you will experience while managing the project.

Taking these premises into account, let's create a directory
structure for our new project, named `modern-cljs`, by adhering as
much as possible to the `boot` defaults.

The suggested file layout of the project is the following:

```bash
modern-cljs/
├── build.boot
├── html
│   └── index.html
└── src
    └── cljs
        └── modern_cljs
            └── core.cljs
```

* `modern-cljs` is the home directory of the project;
* `src/cljs/` hosts CLJS source files;
* `html` hosts html resources;

> NOTE 2: Single segment namespace are
> [discouraged in CLJ/CLJS][5]. That's why we created the
> `modern_cljs` directory name. Due to [Java difficulties][6] in
> managing hyphen "-" (or other special characters) in package names,
> we substituted an underscore (`_`) for any hyphen (`-`) in
> corresponding directory names.

> NOTE 3: Please note that the filename extension for ClojureScript
> sources is **cljs**, not **clj**.

Issue the following command at the terminal:

```bash
mkdir -p modern-cljs/{src/cljs/modern_cljs,html}
```

Let's now create the three needed files by issuing the folowing
command:

```bash
cd modern-cljs
touch html/index.html src/cljs/modern_cljs/core.cljs build.boot
```

## Hello World in CLJS

We're now going to write our very first CLJS code. Open the
`src/cljs/modern_cljs/core.cljs` file with your preferred editor and
type into it the following CLJS code:

```clj
;; create the main project namespace
(ns modern-cljs.core)

;; enable cljs to print to the JS console of the browser
(enable-console-print!)

;; print to the console
(println "Hello, World!")
```

Every CLJ/CLJS file must start with a namespace declaration matching a
path on your disk:

`modern-cljs.core` <--> `modern_cljs/core.cljs`

The `(enable-console-print!)` expression redirects any printed output
to the console of the browser in such a way that the `(println "Hello,
world!")` prints `Hello, World!` to the console.

### Minimal build.boot

We now need a way to compile `core.cljs` to JS and link it to the
`index.html` page.

First, open the file `html/index.html` and edit it as follows:

```html
<!doctype html>
<html>
  <head>
    <title>Hello, World!</title>
  </head>
  <body>
    <script src="main.js"></script>
  </body>
</html>
```

Note that there are no references to CLJS files. We only added a
`<script>` tag to link the `index.html` page to the `main.js`
file. This JS file will be generated by the `boot` building tool while
compiling the above `core.cljs` source code.

To compile the `core.cljs` file, we need to configure the `boot` command by
editing the `build.boot` file, which is just a regular CLJ file with a
different extension:

```clj
(set-env!
 :source-paths #{"src/cljs"}
 :resource-paths #{"html"}

 :dependencies '[[adzerk/boot-cljs "1.7.170-3"]])

(require '[adzerk.boot-cljs :refer [cljs]])
```

Pretty minimal! The `set-env!` function sets `:source-paths` and
`:resource-paths` options to the corresponding values of the project
structure as we have created above. Then it injects the `boot-cljs`
compilation task as the only explicit dependency of the project by
adding it to the `:dependencies` keyword.

Note that even if we did not include any `clojure` and `clojurescript`
dependencies, `boot` will be able to automagically download the
corresponding releases it knows to work well with it.

Finally, the `require` form makes the `cljs` task visible to the
`boot` command.

If you now run the `boot -h` command from the terminal, you'll see
that the `cljs` task is now available to `boot`.

```bash
boot -h

...

Tasks:   ...
         target                      Writes output files to the given dir...
         ...
         zip                         Build a zip file for the project.

         cljs                        Compile ClojureScript applications.

...

Run `boot <task> -h` to see usage info and TASK_OPTS for <task>.
Implicit target dir is deprecated, please use the target task instead.
Set BOOT_EMIT_TARGET=no to disable implicit target dir.
```

Note that `boot` issues a warning saying that using an implicit
target directory is deprecated. Instead you should use the `target`
task and set `BOOT_EMIT_TARGET=no` to disable implicit target
directory generation.

If you don't know anything about the `boot` build tool, that message has
no meaning at all even if you ask for more information with the
following command:

```bash
bot target -h
Writes output files to the given directory on the filesystem.

Options:
  -h, --help      Print this help info.
  -d, --dir PATH  Conj PATH onto the set of directories to write to (target).
  -L, --no-link   Don't create hard links.
  -C, --no-clean  Don't clean target before writing project files.
Implicit target dir is deprecated, please use the target task instead.
Set BOOT_EMIT_TARGET=no to disable implicit target dir.
```

At the moment we don't care about the above deprecation. We only want
to have more information about the `cljs` task by issuing the
following command:

```bash
boot cljs -h
Compile ClojureScript applications.
...
Available --optimization levels (default 'none'):
...
```

As you see, the default optimization directive for the CLJS compiler
is `none`. Another tutorial will explain the different CLJS compilation
optimizations (i.e. `none`, `whitespace`, `simple` and `advanced`). At
the moment stay with `none`, which is commonly used during development
cycles. Let's see `boot cljs` at work:

```bash
boot cljs
Writing main.cljs.edn...
Compiling ClojureScript...
• main.js
```

You now know why we called the JS file included in the
`<script>` tag of the `index.html` page `main.js`: just to adhere to an easy
default.

Let's see what has been generated by the `cljs` compilation task:

```bash
.
├── build.boot
├── html
│   └── index.html
├── src
│   └── cljs
│       └── modern_cljs
│           └── core.cljs
└── target
    ├── index.html
    ├── main.js
    └── main.out
        ├── boot
        │   └── cljs
        │       ├── main494.cljs
        │       ├── main494.cljs.cache.edn
        │       ├── main494.js
        │       └── main494.js.map
        ├── cljs
        │   ├── core.cljs
        │   ├── core.js
        │   └── core.js.map
        ├── cljs_deps.js
        ├── goog
        │   ├── array
        │   │   └── array.js
        │   ├── asserts
        │   │   └── asserts.js
        │   ├── base.js
        │   ├── debug
        │   │   └── error.js
        │   ├── deps.js
        │   ├── dom
        │   │   └── nodetype.js
        │   ├── object
        │   │   └── object.js
        │   └── string
        │       ├── string.js
        │       └── stringbuffer.js
        └── modern_cljs
            ├── core.cljs
            ├── core.cljs.cache.edn
            ├── core.js
            └── core.js.map

17 directories, 26 files
```

A lot of stuff. We're not digging into it right now. At the
moment we're only interested in noting a few things:

* the original directory structure living in `html` and `src` is
  untouched
* everything, even the `index.html` resource, has been generated into
  the new `target` directory. This is the implicit target directory we
  continuously received warning about at any submitted `boot` command.

## Get rid of warnings

Let's get rid of these warnings. First, delete the `target` directory:

```bash
rm -rf target
```

Then, create a new `boot.properties` file as follows:

```bash
boot -V > boot.properties
```

Finally open the `boot.properties` file to disable the implicit target
directory generation:

```bash
#http://boot-clj.com
#Sun Jan 03 10:26:34 CET 2016
BOOT_CLOJURE_NAME=org.clojure/clojure
BOOT_CLOJURE_VERSION=1.7.0
BOOT_VERSION=2.5.5
BOOT_EMIT_TARGET=no
```

This way you're pinning the project to the `2.5.5` release of `boot`
which is the latest available at the time of writing. Take into
account that `boot` maintainers are working hard to continuously add
new features and correcting bugs. This means that in a very short time
a new release could be available. `boot` maintainers follow the rules
of [semantic versioning](http://semver.org/). So, to be sure that the
project we're building runs without any problem, the best thing you
can do is explicitly pin the project to the above `2.5.5.`
release as follows:

```bash
BOOT_VERSION=2.5.5 boot -V > boot.properties
```

Obviously you have to re-add the `BOOT_EMIT_TARGET=no` directive as above.

```bash
#http://boot-clj.com
#Sun Jan 03 10:26:34 CET 2016
BOOT_CLOJURE_NAME=org.clojure/clojure
BOOT_CLOJURE_VERSION=1.7.0
BOOT_VERSION=2.5.5
BOOT_EMIT_TARGET=no
```

You can now safely relaunch the CLJS compilation by composing the
`cljs` and the `target` tasks within the `boot` command as follows:

```bash
boot cljs target -d target
Writing main.cljs.edn...
Compiling ClojureScript...
• main.js
Writing target dir(s)...
```

The start has been a little bit over complicated, but we freed ourself
from the above annoying notification about the implicit target
directory being deprecated.

If you take a look at the `modern-cljs` home directory you'll see
again that everything has been generated under the now explicit
`target` directory.

## Visit index.html

`boot` uses a pretty neat approach in taking apart the input of the
project from the corresponding output generated by its tasks. You'll
never see an input file from the `:source-paths` and the
`:resource-path` original directories be modified by any `boot`
task. Aside from internally generated temporary directories,
everything happens in the explicit `target` directory.

Open a browser and visit the local `target/index.html` file. Now open
the console in your Development Tool (e.g. Chrome Development Tool).
If everything went ok, you should see "Hello, World!" printed at the
console.

## Next Step - [Tutorial 2: Immediate Feedback Principle][7]

In the next [tutorial][7] we're going to adhere as closely as possible to
the [Bret Victor Immediate Feedback Principle][8] to build a very
interactive development environment.

# License

Copyright © Mimmo Cosenza, 2012-2015. Released under the Eclipse Public
License, the same as Clojure.

[1]: https://github.com/clojure/clojurescript.git
[2]: http://boot-clj.com/
[3]: https://java.com/en/download/help/index_installing.xml?os=All+Platforms&j=8&n=20
[4]: https://github.com/boot-clj/boot#install
[5]: http://stackoverflow.com/questions/13567078/whats-wrong-with-single-segment-namespaces
[6]: http://docs.oracle.com/javase/specs/jls/se8/html/jls-6.html
[7]: https://github.com/magomimmo/modern-cljs/blob/master/doc/second-edition/tutorial-02.md
[8]: https://vimeo.com/36579366
